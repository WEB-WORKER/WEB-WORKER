<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Распознавание голоса и чтение текста</title>
  <style>
	  #list{
		list-style-type: none;
	  }
  </style>
</head>
<body>

  <button onclick="speech();">Перезапуск</button>  
  <button onclick="stop()">Остановить</button>
  <button onclick="send()">Отправить</button>
  <button onclick="test()">Тест</button>
  <button onclick="cp()">Кликнуть 2 раза чтобы скопировать</button>
  <ul id="list">    
  </ul>

  <script>
  // Создаем распознаватель
  var recognizer = new webkitSpeechRecognition();
  
  //тип распознавания длительный
  recognizer.continuous = true;
  // Ставим опцию, чтобы распознавание началось ещё до того, как пользователь закончит говорить
  recognizer.interimResults = true;
  // Какой язык будем распознавать?
  recognizer.lang = 'ru-Ru';
  
  var fstarr    = [],
      sndarr    = [],
      resultarr = [],
      res       = [],
      str,
      i = 0,
      result;
    
 var sales = ['приобрести',
         'цвет автомобиля',
         'цвета',
         'конфигуратор',
         'комплектация',
         'комплектации',
         'с пробегом',
         'новый',
         'связаться с отделом продаж',
         'кредитование',
         'купить',
         'покупку',         
         'сколько стоит автомобиль',
         'стоимости автомобиля',
	 'приобретать автомобиль',
         'тест-драйв',
         'лучшая цена',
         'Добрый день отдел продаж',
         'сборка',
         'выставочные образцы',
         'кредитная ставка',
         'новая',
         'посмотреть можно',
         'в наличии',
         'в предложении',
	 'какая вас заинтересовала',
	 'знакомы с машиной',
	 'модельному ряду',
         'условия приобритения',
         'автомобиль со скидкой',
         'если мы рассматриваем эту модель'
	  ];
	  
var service = ['диагностика',
           'техническое обслуживание',
           'масло',
           'замена',
           'менять',
           'отзывная',
           'техобслуживание',
           'запчасти',
           'запчастями',
           'проблем',
           'ошибка',
           'обслуживания',
           'обслуживание',
           'сделать т о',
           'нулевое то',
           'сервисного',
           'сервисного центра',
           'частей',
           'покрасить бампер',
           'шрус',
           'вышел из строя',
           'техобслуживания',
           'обслуживается',
           'обслуживание',
           'сход-развал',
           'завести',
           'меняли',
           'коленвал',
           'масл',
           'замена',
           'записаться',
           'сервису',
           'детали',
           'проверка',
           'консультация',
           'шиномонтаж',
           'перечень',
           'мойка',
           'диагностику',
	   'дефлекторы',
	   'вмятина',
	   'сервисе',
	   'тормоза',
	   'шланги',
	   'хотел бы на то',
	   'диагности',
	   'покраска бампера',
	   'обслужива',
           'масля',
           'топлив',
           'свечи зажигания',
	   ];
	  
var other = ['юридической', 
       'поликлиника',
      'страхование',
      'бухгалтер',
      'пока занят',
      'перерыв'];
	  
var speechFunction = function(){
			speech();
};
	  
   recognizer.onspeechend = speechFunction;
   recognizer.onend = speechFunction;
   recognizer.onerror = speechFunction;
   recognizer.onnomatch = speechFunction;
   recognizer.onsoundend = speechFunction;
    
    // Используем колбек для обработки результатов
    recognizer.onresult = function (event) {
    result = event.results[event.resultIndex];
    
    if (result.isFinal) {            
        fstarr.push(result[0].transcript);        
        //str = fstarr.join();
        console.log('fstarr:', fstarr);       
        
    } else {
           console.log('Промежуточный результат: ' + result[0].transcript);      
          //   console.log('Система записывает промежуточные результаты');
    }
    
    //sndarr = str.split('пирог');
    //console.log('sndarr:', sndarr);
        
    //console.log('str:', str);
    // document.getElementById('cont').innerHTML = str;    
   
  
      
 };    

 function test(){
	 
	console.log('outfstarr:',fstarr);
	 
	str = fstarr.join();
	console.log('str:',str);
	 
	sndarr = str.split('пирог');
 	console.log('outsndarr:',sndarr);
	 
	for (i in sndarr){	
	    if ((sndarr[i]).indexOf('31') != -1 && sndarr[i].length < 18){		    
	    }
	    else {
	    	res = resultarr.push(sndarr[i]);
	    }
	};
	 
	for (i in resultarr){
		for (j in sales){
			if (resultarr[i].indexOf(sales[j]) != -1){
				resultarr[i] = 'Отдел продаж';			
			}
	};
	for (j in service){
			if (resultarr[i].indexOf(service[j]) != -1){
				resultarr[i] = 'Сервис';			
			}
	};
	for (j in other){
			if (resultarr[i].indexOf(other[j]) != -1){
				resultarr[i] = 'Прочее';			
			}
		}
	};
        console.log('resultarr:',resultarr);
	 
	for (i in resultarr){
		console.log(parseInt(i)+1 + '. ' + resultarr[i]);
		var elem = document.createElement("li");
          	    elem.innerHTML = (resultarr[i]);
		    document.getElementById('list').appendChild(elem);
	}
	
 };
 
    
  function send(){
  	 for (i in sndarr){	
	    if ((sndarr[i]).indexOf('31') == -1){
		    res = resultarr.push(sndarr[i]);
	    }
	};
	 
	for (i in resultarr){
		for (j in sales){
			if (resultarr[i].indexOf(sales[j]) != -1){
				resultarr[i] = 'Отдел продаж';			
			}
	};
	for (j in service){
			if (resultarr[i].indexOf(service[j]) != -1){
				resultarr[i] = 'Сервис';			
			}
	};
	for (j in other){
			if (resultarr[i].indexOf(other[j]) != -1){
				resultarr[i] = 'Прочее';			
			}
		}
	};
        console.log('resultarr:',resultarr);
	 
	for (i in resultarr){
		console.log(parseInt(i)+1 + '. ' + resultarr[i]);
		var elem = document.createElement("li");
          	    elem.innerHTML = (resultarr[i]);
		    document.getElementById('list').appendChild(elem);
	}
	  
	
  }	  
	  
	  
	  
  function speech(){
    // Начинаем слушать микрофон и распознавать голос
    recognizer.stop();  
    setTimeout(function() { recognizer.start() }, 10);
  }
  
  
  function stop(){
    recognizer.stop();
  }
	  
	  
//Копирование в буфер обмена:	  
function cp(){
  //нашли наш контейнер
  var ta = document.getElementById('list'); 
  //производим его выделение
  var range = document.createRange();
  range.selectNode(ta); 
  window.getSelection().addRange(range); 
 
  //пытаемся скопировать текст в буфер обмена
  try { 
    document.execCommand('copy'); 
  } catch(err) { 
    console.log('Can`t copy, boss'); 
  } 
  //очистим выделение текста, чтобы пользователь "не парился"
  window.getSelection().removeAllRanges();
};
	  
  
 // setInterval(function() { speech() }, 10000);
    
 // recognizer.onerror = function() { speech() };
  
  
  </script>

</body>
</html>
