<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Распознавание голоса и чтение текста</title>
</head>
<body>

  <button onclick="speech();">Перезапуск</button>  
  <button onclick="stop()">Остановить</button>
  <div id="cont">    
  </div>

  <script>
  // Создаем распознаватель
  var recognizer = new webkitSpeechRecognition();
  
  //тип распознавания длительный
  recognizer.continuous = true;
  // Ставим опцию, чтобы распознавание началось ещё до того, как пользователь закончит говорить
  recognizer.interimResults = true;
  // Какой язык будем распознавать?
  recognizer.lang = 'ru-Ru';
  
  var arr = [],
      resultarr = [],
      str,
      i = 0;    
   
    
  // Используем колбек для обработки результатов
  recognizer.onresult = function (event) {
    var result = event.results[event.resultIndex];   
    
    
    
    if (result.isFinal) {            
        arr.push(result[0].transcript);        
        str = arr.join();
        console.log('arr:', arr);       
        
    } else {
      
          // console.log('Промежуточный результат: ', 'result[0].transcript');      
          //   console.log('Система записывает промежуточные результаты');
             
             
    }
    resultarr = str.split('следующий файл');
    console.log('resultarr:', resultarr);
    
    
    
    
    //console.log('str:', str);
    document.getElementById('cont').innerHTML = str;
    
    
    
  };
    
    
    
  function speech(){
    // Начинаем слушать микрофон и распознавать голос
    recognizer.stop();  
    setTimeout(function() { recognizer.start() }, 300);
  }
    
  

  
   //если аудио кончается начинаем распознавать снова
 // recognizer.onspeechend = function() {
 //   recognizer.start();
 // }
  function stop(){
    recognizer.stop();
  }
  
 setInterval(function() { speech() }, 5000);
    
 recognizer.onerror = function() { speech() };
  
  
  </script>

</body>
</html>
